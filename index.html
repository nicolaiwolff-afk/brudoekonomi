<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Brudøkonomi</title>

<style>
body{font-family:system-ui;background:#f6f7f8;margin:0}
.wrap{max-width:700px;margin:auto;padding:40px 20px}
.card{background:#fff;border-radius:14px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
h1{margin-top:0}
label{display:block;margin-top:14px;font-weight:600}
input{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin-top:6px}
button{margin-top:20px;padding:14px;border-radius:10px;border:0;background:#111;color:#fff;font-size:16px;width:100%}
.kpi{margin-top:10px}
</style>
</head>

<body>
<div class="wrap">
<div class="card">
<h1>Brudøkonomi</h1>

<label>Boligens værdi</label>
<input id="home" type="number">

<label>Restgæld</label>
<input id="mortgage" type="number">

<label>Din ejerandel (%)</label>
<input id="share" type="number">

<label>Din månedlige indkomst</label>
<input id="income" type="number">

<label>Din øvrige gæld</label>
<input id="debt" type="number">

<button id="calc">Beregn</button>

<div id="preview"></div>

<button id="buy" style="display:none">Få fuld rapport (49 kr)</button>
</div>
</div>

<script>
function fmt(n){
 return new Intl.NumberFormat("da-DK",{style:"currency",currency:"DKK",maximumFractionDigits:0}).format(n)
}

let report = null;

document.getElementById("calc").onclick = () => {
 const home = Number(homeInput.value);
 const mortgage = Number(mortgageInput.value);
 const share = Number(shareInput.value)/100;
 const income = Number(incomeInput.value);
 const debt = Number(debtInput.value);

 const equity = home - mortgage;
 const yourEquity = equity * share;
 const payout = equity * (1-share);
 const totalDebt = mortgage + payout + debt;

 report = {
   ts: new Date().toISOString(),
   homeValue: home,
   mortgage: mortgage,
   sharePct: share*100,
   incomeMonthly: income,
   otherDebt: debt,
   equity: equity,
   saleProceeds: yourEquity,
   payoutToPartner: payout,
   totalDebtAfterTakeover: totalDebt
 };

 localStorage.setItem("brudoekonomi:last_report", JSON.stringify(report));

 preview.innerHTML = `
 <p class="kpi">Din friværdi: <b>${fmt(yourEquity)}</b></p>
 <p class="kpi">Udbetaling til partner: <b>${fmt(payout)}</b></p>
 <p class="kpi">Gæld efter overtagelse: <b>${fmt(totalDebt)}</b></p>
 `;

 buy.style.display = "block";
};

const homeInput = document.getElementById("home");
const mortgageInput = document.getElementById("mortgage");
const shareInput = document.getElementById("share");
const incomeInput = document.getElementById("income");
const debtInput = document.getElementById("debt");

document.getElementById("buy").onclick = async () => {
 const res = await fetch("/api/create-checkout");
 const data = await res.json();
 window.location = data.url;
};
</script>
</body>
</html>
